<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Flappy Jay</title>

</head>
<body>
	<center>
	<canvas id="canvas" width="343" height="480"></canvas>
	<script src="img.js" type="text/javascript"></script>
	<script src="bird.js" type="text/javascript"></script>
	
	<script>
function getRandom(min, max) {
  return Math.random() * (max - min) + min; 
}		
let gap=200;
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let up_height = getRandom(100,200);
let down_height= 453-gap-up_height;
let pipegap=120;






function FlappyBird() {}
FlappyBird.prototype = {
	bird: null, // bird
	bg: null, // background

	mapWidth: 340, // width
	mapHeight: 453, // height
	startX: 90, // intinal position
	startY: 225,
	
	upSpeed: 7, // Up speed
	downSpeed: 2, // Down speed
	line: 56, // height of land	
	
	CreateMap: function() {
		// back ground
		this.bg = new Image();
		this.bg.src = "img/bg.png";
		var startBg = new Image();
		startBg.src = "img/start.jpg";
		// draw imgs
		startBg.onload = function(){
			ctx.drawImage(startBg, 0, 0);
		};
	  
		
		//bird
		var image = new Image();
		image.src = "img/bird.png";		
		image.onload = function(){
			this.bird = new Bird(this.startX, this.startY, image);
		}.bind(this)
		
	
	},
	
	CanMove: function() { 
		if (this.bird.y < 0 || this.bird.y > this.mapHeight - this.bird.height - this.line) {
			this.gameOver = true;
		} else {
			var boundary = [{
				x: this.bird.x,
				y: this.bird.y
			}, {
				x: this.bird.x + this.bird.width,
				y: this.bird.y
			}, {
				x: this.bird.x,
				y: this.bird.y + this.bird.height
			}, {
				x: this.bird.x + this.bird.width,
				y: this.bird.y + this.bird.height
			}];
		}
	},
	CheckTouch: function() {       
		if (this.touch) {
			this.bird.y -= this.upSpeed;
			this.bird.draw(ctx, "up");
		} else {
			this.bird.y += this.downSpeed;
			this.bird.draw(ctx, "down");
		}
	},
	ClearScreen: function() { // when begin the game, clean the screen and add bird and pipes
		ctx.drawImage(this.bg, 0, 0);
		
		
	},



	create_down_Pipe: function()
	{
		var pdimage = new Image();
		var pdmimage = new Image();
		pdimage.src = "img/down_pipe.png";
		pdmimage.src = "img/down_mod.png";		
		pdimage.onload = function(){
			ctx.drawImage(pdimage,180,300,40,down_height)
			ctx.drawImage(pdmimage,180,360,40,50)
		}.bind(this);
	},

	create_up_Pipe: function()
	{
		var puimage = new Image();
		var pumimage = new Image();
		puimage.src = "img/up_pipe.png";
		pumimage.src = "img/up_mod.png";		
		puimage.onload = function(){
			ctx.drawImage(puimage,180,50,40,up_height)
			ctx.drawImage(pumimage,180,0,40,100)
		}.bind(this);
	},









	ShowOver: function() {
		var overImg = new Image();
		overImg.src = "img/over.png";
		overImg.onload = function(){
			ctx.drawImage(overImg, (this.mapWidth - overImg.width) / 2, (this.mapHeight - overImg.height) / 2 - 50);
		}.bind(this);
		return;
	}

	
};

var game = new FlappyBird();
var Speed = 20;
var IsPlay = false;
var GameTime = null;
var btn_start;
window.onload = InitGame;

function InitGame() {
	ctx.font = "40px Arial";
	game.CreateMap();
	
  
	canvas.onmousedown = function() {
		game.touch = true;
	}
	canvas.onmouseup = function() {
		game.touch = false;
	};
	canvas.onclick = function() {
		if (!IsPlay) {
			IsPlay = true;
			GameTime = RunGame(Speed);
		}
		
	}
	

}

function RunGame(speed) {
	var updateTimer = setInterval(function() {
		game.create_down_Pipe();
		game.create_up_Pipe();
		game.CanMove();
		if (game.gameOver) {
			game.ShowOver();
			clearInterval(updateTimer);
			return;
		}
		game.ClearScreen();
		
		game.CheckTouch();
		
		
	}, 20);
}
	</script>
</body>
</html>